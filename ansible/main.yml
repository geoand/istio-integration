---
- hosts: localhost
  gather_facts: true
  vars_files:
    - etc/config.yaml

  tasks:
    - import_tasks: minishift/delete.yml
      when: action == 'delete-vm'

    # Create Minishift instance using config defined within etc/config.yaml file and start minishift
    - block:
      - import_tasks: minishift/delete.yml
      - import_tasks: minishift/config.yml
      - import_tasks: minishift/start.yml
      - import_tasks: ocp/log_admin.yml
      when: action == 'create-vm'

    # Start Minishift
    - block:
      - import_tasks: minishift/start.yml
      - import_tasks: ocp/log_admin.yml
      when: action == 'default'

    # Install Istio Distro if it doesn't exist
    - import_tasks: istio/install_distro.yml
      when: action == 'install-distro'

    # Install Istio on Minishift
    - name: Install Istio on Minishift OCP
      block:
      - import_tasks: istio/set_istio_distro_dir.yml
      - import_tasks: istio/create_namespace.yml
      - import_tasks: istio/change_scc.yml
      - import_tasks: istio/install_on_ocp.yml
      when: action == 'install-istio'

    # Open Web Screens of the Applications
    - import_tasks: istio/open_apps.yml
      when: action == 'launch'



